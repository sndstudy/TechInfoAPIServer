parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"qG4j":[function(require,module,exports) {
module.exports={type:"service_account",project_id:"tech-info-ss",private_key_id:"65a2f6bb3968d74b824c9ea42edd4288043eced1",private_key:"-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCx+FEuyvV4NrP5\nU9oDnEF/tOjzcxF+h7VyeE9TFPD6YQOQ+gk4Klp25Ek/gaYbIeGt0IlXltpnHU+4\n78rIfRjxYmj1bWSfVxX77VomKADAbmCtWKI20For2r87Sq3BwHM2G7vObYe3NBnY\n23TwvMlVWHKJZG9s8V6yymo8WoxhrYFyqEgrcUwzg9h9EMrka9D2U+duP1AQCkey\n0jqM8xFd6y1nrbZtsGEp4LaNYrp9OiSM0JRIbmfrxYF8ubfu4cnCHo0lHzL4WE7l\n0i+zMu/+51d2gaxYSRaOaL1QAukRC1mLzrxB7V6WO+IKsfGctiuoGuRZQepso+iK\n3Rc2FCuHAgMBAAECggEADJpr6V2CVhT0C6XJn44HwQSUDXWD8vFz9if/k7MjQGy+\nK2l0w+KTJuGr/EOkRz42TknuOy+Zxn0Em2SqRPNy+j+NWxNE2At7QsZNJyMxfNWN\n1bwCoZ4bD9YwZIFsqt1qa0kG597JO/FqtfkPBknGrXTgVTF+U8YHsXxBjlLQdGd0\nclhuy09qBqc2gYHtieJ2w5b6t5r5QlQweDY+tUvOukXQ3v+6cgT41cURCpqsw8k3\n2XTpergNsp9C2Q+MZkzbrMtl3vGplXpXfjUhLerTD83FlUrJ3Z70yJDkgk2ucO4J\nN3SInmBU2/O35yse0NHzfR2cD6my8ObKA2UDB4PX4QKBgQD4pqve6uSDGIO/I02V\nEloY8PkulPXMHzSb+1FKYUeA03d0Wui8TN9lUIP8ILNIF1KoVdVpmWcFJAbJoFn5\nt4d69RhPXEo5dhgUls/Cn234DuldSVQXwEDPu9GVK+7keki5AOmI3ECRkD343b+7\n6efljZT4tZnLVTpfD2Rmm8Jh5wKBgQC3Otzm5bDm40a6MElPomwk9Sg+0KqQj6K+\nA1o7VBQ70TJvEFgDSwSOBN3F2u0HSUtFotBxn1b4BUywX9/CTm2hqfHNG7OUY3LQ\n5XufdnMCJsNyyjULu2TOYvGaWqRwbL8k3WIh8bdeENfJhTX35rZn6Z/c+VOu7jCl\nFyhEJw31YQKBgG8sZjAXKfCLZ2xwZmG+gNYh9+eh5nxLf4Q2S9RLxmKNKh21/9Uh\nMcjkxP5XyJD1DJoDNpYuZmdgAkDoFxKVwldxelsRUoZ6jK23+FB2Y/7C/Agfnx+3\nb8LxoPVnXTp+ikFdbQ0qHRx4N50r2Gw2Wt7B/NduqsLE6oJSKXvPLIwFAoGACr6N\n45BGflOHezWHpv7MPqKNmJld1xpFHcVOjjoQ8a0DuxWHQ7IrczR/2LFMwueeXVf9\nxxvj2qlc5N7KXTeCID+56SAduK7YNb2vMRueBNtHDL0kvSpg7+VHa5izGdCWqM++\niGUHLqHoNW31SzMhMRi3AhswuApJmfSwrMZpgCECgYAF7jUC/PuTw7F+hc7xVUfs\npJF/KgTpikw3OumrWFLdvuv7hMVuQVQK2Cq4qTJlZn+JZspHwMt8kpDI371g+beQ\nzYmk65FSqlMBpWAnR89DmuyWWI4Ps/XUbc9WjSSkXH4UCR5O01nKBgCM/q9kvupL\nQB7QwsRelDWbEBAgn99cKw==\n-----END PRIVATE KEY-----\n",client_email:"firebase-adminsdk-1jtv8@tech-info-ss.iam.gserviceaccount.com",client_id:"100964475142793841712",auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://oauth2.googleapis.com/token",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs",client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-1jtv8%40tech-info-ss.iam.gserviceaccount.com"};
},{}],"v26u":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("firebase-admin"),s=require("./tech-info-ss-serviceAccountKey.json");class c{constructor(){}}c.app=e.initializeApp({credential:e.credential.cert(Object.assign({},s))}),exports.BaseDbAccess=c;
},{"./tech-info-ss-serviceAccountKey.json":"qG4j"}],"Hzxl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./base_db_access");class c extends e.BaseDbAccess{async selectItems(c,t){const s=e.BaseDbAccess.app.firestore(),o=s.collection("qiita").doc(t),a=(await o.getCollections().catch(()=>{throw new Error("Firebase エラー")})).find(e=>+e.id>c),i=[];if(a){(await s.collection("qiita").doc(t).collection(a.id).get().catch(()=>{throw new Error("Firebase エラー")})).forEach(e=>{i.push(e.data())})}return i}async insertItems(c,t,s){const o=e.BaseDbAccess.app.firestore(),a=o.batch();for(let e of c){const c=o.collection("qiita").doc(s).collection(`${t}`).doc();a.set(c,e)}await a.commit().catch(()=>{throw new Error("Firebase エラー")})}}exports.QiitaDbAccess=c;
},{"./base_db_access":"v26u"}],"tTBL":[function(require,module,exports) {
"use strict";var r;Object.defineProperty(exports,"__esModule",{value:!0}),function(r){r[r.NotFound=404]="NotFound",r[r.MethodNotAllowed=405]="MethodNotAllowed",r[r.InternalServerError=500]="InternalServerError"}(r=exports.ErrorEnum||(exports.ErrorEnum={}));
},{}],"umIr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("axios"),r=require("express"),t=require("../db/qiita_db_access"),a=require("../error/error_enum");exports.router=r.Router(),exports.router.route("/").get(async(r,u,o)=>{try{const i={params:{page:r.query.page||1,per_page:r.query.perPage||20,query:r.query.query?`tag:${r.query.query}`:"tag:JavaScript"}},n=Math.floor(Date.now()/1e3),l=n-28800,c=new t.QiitaDbAccess;let q=await c.selectItems(l,r.query.query);if(0===q.length){q=(await e.default.get("https://qiita.com/api/v2/items",i).catch(e=>{throw new Error("axios エラー")})).data.map(e=>({tags:r.query.query?[r.query.query]:["Javascript"],title:e.title,url:e.url,tweetUrl:`https://twitter.com/intent/tweet?text=${e.title}&url=${e.url}`})),c.insertItems(q,n,r.query.query||"javascript")}return u.json(q)}catch(s){return o(a.ErrorEnum.InternalServerError)}}).post(async(e,r,t)=>t(a.ErrorEnum.MethodNotAllowed)).put(async(e,r,t)=>t(a.ErrorEnum.MethodNotAllowed)).delete(async(e,r,t)=>t(a.ErrorEnum.MethodNotAllowed));
},{"../db/qiita_db_access":"Hzxl","../error/error_enum":"tTBL"}],"a4Qw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./base_db_access");class c extends e.BaseDbAccess{async selectItems(c,s){const t=e.BaseDbAccess.app.firestore(),o=t.collection("hackernews").doc(s),r=(await o.getCollections().catch(()=>{throw new Error("Firebase エラー")})).find(e=>+e.id>c),a=[];if(r){(await t.collection("hackernews").doc(s).collection(r.id).get().catch(()=>{throw new Error("Firebase エラー")})).forEach(e=>{a.push(e.data())})}return a}async insertItems(c,s,t){const o=e.BaseDbAccess.app.firestore(),r=o.batch();for(let e of c){const c=o.collection("hackernews").doc(t).collection(`${s}`).doc();r.set(c,e)}await r.commit().catch(()=>{throw new Error("Firebase エラー")})}}exports.HackerNewsDbAccess=c;
},{"./base_db_access":"v26u"}],"dxni":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("axios"),r=require("express"),t=require("../db/hackernews_db_access"),a=require("../error/error_enum");exports.router=r.Router(),exports.router.route("/").get(async(r,s,o)=>{try{const n={params:{hitsPerPage:r.query.perPage||20,query:r.query.query||"javascript",tags:r.query.tags||"story"}},c=Math.floor(Date.now()/1e3),i=c-28800,l=new t.HackerNewsDbAccess;let y=await l.selectItems(i,r.query.query);if(0===y.length){y=(await e.default.get("http://hn.algolia.com/api/v1/search_by_date",n).catch(e=>{throw new Error("axios エラー")})).data.hits.map(e=>({tags:r.query.query?[r.query.query]:["javascript"],title:e.title,url:e.url,tweetUrl:`https://twitter.com/intent/tweet?text=${e.title}&url=${e.url}`})),await l.insertItems(y,c,r.query.query||"javascript")}return s.status(200).json(y)}catch(u){return o(a.ErrorEnum.InternalServerError)}}).post(async(e,r,t)=>t(a.ErrorEnum.MethodNotAllowed)).put(async(e,r,t)=>t(a.ErrorEnum.MethodNotAllowed)).delete(async(e,r,t)=>t(a.ErrorEnum.MethodNotAllowed));
},{"../db/hackernews_db_access":"a4Qw","../error/error_enum":"tTBL"}],"tA2m":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class s{constructor(s,e,r){this.statusCode=s,this.message=e,this.errorObj=r}}exports.ErrorInfo=s;
},{}],"uRng":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const r=require("./error_enum"),o=require("./error_info");exports.errorHandler=((e,n,t,u)=>{switch(e){case r.ErrorEnum.NotFound:return t.status(r.ErrorEnum.NotFound).json(new o.ErrorInfo(r.ErrorEnum.NotFound,"Not Found"));case r.ErrorEnum.MethodNotAllowed:return t.status(r.ErrorEnum.MethodNotAllowed).json(new o.ErrorInfo(r.ErrorEnum.MethodNotAllowed,"Method Not Allowed"));default:return t.status(r.ErrorEnum.InternalServerError).json(new o.ErrorInfo(r.ErrorEnum.InternalServerError,"Internal Server Error"))}});
},{"./error_enum":"tTBL","./error_info":"tA2m"}],"Focm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("express"),r=require("./api/qiita_api"),s=require("./api/hackernews_api"),i=require("./error/error_handler"),t=e();t.use((e,r,s)=>{r.header("Access-Control-Allow-Origin","*"),r.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),s()}),t.use("/qiita",r.router),t.use("/hackernews",s.router),t.use(i.errorHandler),t.listen(process.env.PORT||3e3);
},{"./api/qiita_api":"umIr","./api/hackernews_api":"dxni","./error/error_handler":"uRng"}]},{},["Focm"], null)
//# sourceMappingURL=/index.js.map